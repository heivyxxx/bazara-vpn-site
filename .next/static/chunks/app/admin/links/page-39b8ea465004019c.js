(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16],{5081:function(e,t,a){Promise.resolve().then(a.bind(a,7659))},7659:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var l=a(7437),s=a(2265);let n="https://vpn.bazara.app",r=[{label:"1м+",days:30},{label:"2м+",days:60},{label:"3м+",days:90},{label:"4м+",days:120},{label:"5м+",days:150},{label:"6м+",days:180},{label:"7м+",days:210},{label:"8м+",days:240},{label:"9м+",days:270},{label:"10м+",days:300},{label:"11м+",days:330},{label:"12м+",days:360}];function o(e){return e?new Date(e).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"}):"-"}function i(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(!0),[c,d]=(0,s.useState)("all"),[x,u]=(0,s.useState)(0),[h,p]=(0,s.useState)(""),[m,f]=(0,s.useState)(""),[b,g]=(0,s.useState)(""),[v,w]=(0,s.useState)(!1),[y,j]=(0,s.useState)(30),[N,k]=(0,s.useState)(1),[S,C]=(0,s.useState)(!1),[D,T]=(0,s.useState)([]),[z,O]=(0,s.useState)(!1),[L,E]=(0,s.useState)(!1),I=(0,s.useRef)(null),[_,M]=(0,s.useState)(!1),[A,P]=(0,s.useState)(""),[R,B]=(0,s.useState)(!1),[J,W]=(0,s.useState)(null),[F,U]=(0,s.useState)(!1),q=(0,s.useRef)(null);function G(){return e.filter(e=>{var t;return("all"===c||e.creator===c)&&(!(x>0)||!!e.days&&!(e.days<x))&&(!b||!!((null===(t=e.key)||void 0===t?void 0:t.toLowerCase().includes(b.toLowerCase()))||"https://vpn.bazara.app/vless/".concat(e.key).toLowerCase().includes(b.toLowerCase())))})}async function H(a){if(window.confirm("Удалить ссылку? Это действие необратимо.")){f(a);try{await fetch("".concat(n,"/api/delete-user/").concat(a),{method:"DELETE"}),t(e.filter(e=>e.key!==a))}catch(e){console.error("Ошибка при удалении:",e),alert("Ошибка при удалении ссылки")}f("")}}async function K(){if(!y||y<1||!N||N<1)return;C(!0),T([]),O(!1);let e=[];for(let t=0;t<N;++t){let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a="";for(let l=0;l<e;++l)a+=t[Math.floor(Math.random()*t.length)];return a}(8);try{let a=await fetch("https://vpn.bazara.app/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_id:t,package_days:y,creator:"admin"})}),l=await a.json();l&&"ok"===l.status?e.push("https://vpn.bazara.app/vless/".concat(t)):e.push("Ошибка генерации"),T([...e])}catch(t){e.push("Ошибка генерации"),T([...e])}}C(!1)}async function Q(){B(!0),W(null),U(!0);try{let e=await fetch("".concat(n,"/api/delete-all-users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:A})}),t=await e.json();if(200!==e.status){W({step:t.error||"Ошибка",details:null}),B(!1);return}}catch(e){W({step:"Ошибка запуска удаления",details:String(e)})}B(!1),M(!1)}return(0,s.useEffect)(()=>{(async function(){i(!0);try{let e=await fetch("https://vpn.bazara.app/api/links"),a=await e.json();t(a.links||[])}catch(e){t([])}i(!1)})()},[]),(0,s.useEffect)(()=>{if(F)return q.current=setInterval(async()=>{let e=await fetch("".concat(n,"/api/delete-all-users/status")),t=await e.json();W(t),t.step&&t.step.includes("завершено")&&q.current&&clearInterval(q.current)},2e3),()=>{q.current&&clearInterval(q.current)}},[F]),(0,l.jsxs)("main",{className:"w-full max-w-2xl mx-auto flex flex-col gap-10 py-16 px-4 items-center",children:[(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:4,alignSelf:"flex-start",width:"100%"},children:(0,l.jsx)("button",{onClick:()=>window.location.href="/admin",style:{background:"none",border:"none",padding:0,marginBottom:2,cursor:"pointer",outline:"none"},title:"Назад",children:(0,l.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"#ff8800",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",style:{transition:"stroke 0.2s"},children:(0,l.jsx)("path",{d:"M15 18l-6-6 6-6"})})})}),(0,l.jsx)("h1",{className:"text-3xl font-extrabold text-white mb-8",children:"Все ссылки"}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 w-full mb-8",children:[(0,l.jsx)("button",{onClick:()=>{w(!0),j(30),k(1),T([]),O(!1)},className:"flex-1 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-bold rounded-xl px-6 py-4 text-lg shadow hover:scale-105 transition-transform",children:"Создать ссылку"}),(0,l.jsx)("button",{onClick:()=>{M(!0),P(""),W(null)},className:"flex-1 bg-gradient-to-r from-red-500 to-orange-500 text-white font-bold rounded-xl px-6 py-4 text-lg shadow hover:scale-105 transition-transform",children:"Удалить всех пользователей"})]}),v&&(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",children:(0,l.jsxs)("div",{className:"bg-[#232323] rounded-3xl shadow-2xl p-8 w-full max-w-xs flex flex-col items-center animate-fade-in relative",children:[(0,l.jsx)("button",{onClick:()=>w(!1),className:"absolute top-4 right-4 text-3xl text-gray-400 hover:text-orange-400 font-bold",children:"\xd7"}),(0,l.jsx)("div",{className:"text-xl font-bold text-white mb-4",children:"Создать тестовые ссылки"}),(0,l.jsxs)("div",{className:"w-full flex flex-col gap-3 mb-4",children:[(0,l.jsx)("label",{className:"text-white text-base font-semibold mb-1",children:"Срок действия (дней):"}),(0,l.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,l.jsx)("input",{ref:I,type:"number",min:1,max:9999,value:y,onChange:e=>j(Number(e.target.value)),className:"flex-1 rounded-lg px-4 py-3 text-base text-white font-semibold bg-[#181818] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-400",style:{textAlign:"center"}}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{type:"button",className:"bg-[#444] text-white rounded-lg px-3 py-2 font-semibold hover:bg-orange-500 transition",onClick:e=>{e.preventDefault(),e.stopPropagation(),E(e=>!e)},children:"Месяцы ▼"}),L&&(0,l.jsx)("div",{className:"absolute left-0 top-full mt-1 bg-[#232323] border border-orange-400 rounded-xl shadow-lg z-10 w-32 max-h-64 overflow-y-auto",children:[...Array(12)].map((e,t)=>(0,l.jsxs)("button",{className:"block w-full text-left px-4 py-2 hover:bg-orange-500 hover:text-white text-white",onClick:()=>{j(30*(t+1)),setTimeout(()=>I.current&&I.current.focus(),100),E(!1)},children:[t+1," мес. (",(t+1)*30," д.)"]},t+1))})]})]}),(0,l.jsx)("label",{className:"text-white text-base font-semibold mb-1 mt-2",children:"Количество ссылок:"}),(0,l.jsx)("input",{type:"number",min:1,max:50,value:N,onChange:e=>k(Number(e.target.value)),className:"w-full rounded-lg px-4 py-3 text-base text-white font-semibold bg-[#181818] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-400 text-center"})]}),(0,l.jsx)("button",{onClick:K,disabled:S||!y||y<1||!N||N<1,className:"w-full bg-gradient-to-r from-orange-500 to-purple-500 text-white font-bold rounded-xl px-6 py-3 text-lg shadow hover:scale-105 transition-transform mb-2 disabled:opacity-60",children:S?"Генерация... (".concat(D.length,"/").concat(N,")"):"Создать"}),D.length>0&&(0,l.jsxs)("div",{className:"w-full mt-4 flex flex-col items-center gap-2 max-h-60 overflow-y-auto",children:[D.map((e,t)=>(0,l.jsxs)("div",{className:"w-full flex gap-2 items-center mb-1",children:[(0,l.jsx)("input",{type:"text",readOnly:!0,value:e,className:"flex-1 rounded-lg px-2 py-1 text-base text-white bg-[#181818] select-all"}),(0,l.jsx)("button",{onClick:()=>{e&&navigator.clipboard.writeText(e).then(()=>{O(!0),setTimeout(()=>O(!1),1500)})},className:"bg-orange-500 text-white font-bold rounded-xl px-2 py-1 shadow hover:bg-orange-600 transition-transform",children:"Скопировать"})]},t)),z&&(0,l.jsx)("div",{className:"text-green-400 mt-2",children:"Скопировано!"})]})]})}),_&&(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",children:(0,l.jsxs)("div",{className:"bg-[#232323] rounded-3xl shadow-2xl p-8 w-full max-w-xs flex flex-col items-center animate-fade-in relative",children:[(0,l.jsx)("button",{onClick:()=>M(!1),className:"absolute top-4 right-4 text-3xl text-gray-400 hover:text-orange-400 font-bold",children:"\xd7"}),(0,l.jsx)("div",{className:"text-xl font-bold text-white mb-4",children:"Удалить всех пользователей"}),(0,l.jsxs)("div",{className:"text-red-400 text-center mb-4",children:["Это действие ",(0,l.jsx)("b",{children:"необратимо"}),"!",(0,l.jsx)("br",{}),"Все пользователи и конфиги будут удалены."]}),(0,l.jsx)("input",{type:"password",placeholder:"Введите пароль...",value:A,onChange:e=>P(e.target.value),className:"w-full rounded-lg px-4 py-3 text-base text-white font-semibold bg-[#181818] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-400 text-center mb-4",disabled:R}),(0,l.jsx)("button",{onClick:Q,disabled:R||!A,className:"w-full bg-gradient-to-r from-red-500 to-orange-500 text-white font-bold rounded-xl px-6 py-3 text-lg shadow hover:scale-105 transition-transform mb-2 disabled:opacity-60",children:R?"Запуск...":"Удалить всех"}),J&&(0,l.jsx)("div",{className:"text-red-400 mt-2",children:J.step})]})}),F&&(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",children:(0,l.jsxs)("div",{className:"bg-[#232323] rounded-3xl shadow-2xl p-8 w-full max-w-xs flex flex-col items-center animate-fade-in relative",children:[(0,l.jsx)("button",{onClick:()=>{U(!1),W(null)},className:"absolute top-4 right-4 text-3xl text-gray-400 hover:text-orange-400 font-bold",children:"\xd7"}),(0,l.jsx)("div",{className:"text-xl font-bold text-white mb-4",children:"Прогресс удаления"}),(0,l.jsx)("div",{className:"w-full text-white text-base mb-2 min-h-[60px]",style:{whiteSpace:"pre-line"},children:J?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{children:J.step}),J.details&&(0,l.jsx)("div",{className:"text-orange-400 text-xs mt-2",children:J.details})]}):"Ожидание..."}),J&&J.step&&J.step.includes("завершено")&&(0,l.jsx)("button",{onClick:()=>U(!1),className:"w-full bg-gradient-to-r from-orange-500 to-purple-500 text-white font-bold rounded-xl px-6 py-3 text-lg shadow hover:scale-105 transition-transform mt-4",children:"Закрыть"})]})}),(0,l.jsx)("input",{type:"text",value:b,onChange:e=>g(e.target.value),placeholder:"Поиск по ссылке или ключу...",className:"w-full mb-6 rounded-xl px-4 py-2 text-lg font-semibold bg-[#181818] text-white border border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-400"}),(0,l.jsxs)("div",{className:"flex gap-4 mb-8 w-full justify-center",children:[(0,l.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"rounded-xl px-4 py-2 text-lg font-semibold bg-[#181818] text-white border border-orange-400",children:[(0,l.jsx)("option",{value:"all",children:"Все"}),(0,l.jsx)("option",{value:"admin",children:"Админ"}),(0,l.jsx)("option",{value:"user",children:"Юзер"})]}),(0,l.jsxs)("select",{value:x,onChange:e=>u(Number(e.target.value)),className:"rounded-xl px-4 py-2 text-lg font-semibold bg-[#181818] text-white border border-orange-400",children:[(0,l.jsx)("option",{value:0,children:"Любой срок"}),r.map(e=>(0,l.jsx)("option",{value:e.days,children:e.label},e.days))]})]}),a?(0,l.jsx)("div",{className:"text-lg text-gray-300",children:"Загрузка..."}):0===G().length?(0,l.jsx)("div",{className:"text-lg text-gray-400",children:"Нет ссылок по выбранным фильтрам."}):(0,l.jsx)("div",{className:"w-full flex flex-col gap-6",children:G().map((e,t)=>{var a;let s=e.createdAt?new Date(e.createdAt):null,n=s&&e.days?new Date(s.getTime()+864e5*e.days):null,r=n?(a=n.toISOString())?new Date<new Date(a)?{text:"Активна",color:"#22d37b"}:{text:"Истекла",color:"#ff4444"}:{text:"Неизвестно",color:"#888888"}:{text:"-",color:"#aaa"},i=e.key||"unknown-".concat(t);return(0,l.jsxs)("div",{className:"bg-[#232323] rounded-2xl shadow-xl px-6 py-5 flex flex-col gap-2 border border-[#333] relative",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsxs)("span",{className:"text-2xl select-all font-mono text-white break-all flex-1",children:["https://vpn.bazara.app/vless/",i]}),(0,l.jsx)("span",{title:"admin"===e.creator?"Админ":"Юзер",className:"ml-2 text-2xl",children:"admin"===e.creator?"\uD83D\uDC51":"\uD83D\uDC64"}),(0,l.jsx)("button",{onClick:()=>(function(e){navigator.clipboard.writeText(e).then(()=>{p(e),setTimeout(()=>p(""),1500)})})("https://vpn.bazara.app/vless/".concat(i)),className:"ml-2 bg-gradient-to-r from-orange-500 to-purple-500 text-white font-bold rounded-xl px-3 py-1 shadow hover:scale-105 transition-transform text-base",children:"Копировать"}),h==="https://vpn.bazara.app/vless/".concat(i)&&(0,l.jsx)("span",{className:"text-green-400 ml-2",children:"Скопировано!"}),(0,l.jsx)("button",{onClick:()=>H(i),disabled:m===i,className:"ml-2 bg-[#2c2c2c] text-red-400 rounded-xl px-2 py-1 shadow hover:bg-red-600 hover:text-white transition-transform text-base disabled:opacity-60",children:(0,l.jsx)("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{stroke:"currentColor",strokeWidth:"2",d:"M6 6l12 12M6 18L18 6"})})})]}),(0,l.jsxs)("div",{className:"text-lg space-y-1",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Создано:"})," ",s?o(s.toISOString()):"-"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Период:"})," ",e.days?"".concat(e.days," дней"):"-"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Истекает:"})," ",n?o(n.toISOString()):"-"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Осталось:"})," ",n?function(e){if(!e)return"-";let t=new Date,a=Math.ceil((new Date(e).getTime()-t.getTime())/864e5);return a<0?"Истекла":"".concat(a," дн.")}(n.toISOString()):"-"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Статус:"})," ",(0,l.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,l.jsx)("span",{style:{background:r.color,borderRadius:"50%",width:10,height:10,display:"inline-block"}})," ",(0,l.jsx)("span",{style:{color:r.color},children:r.text})]})]})]})]},i)})})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=5081)}),_N_E=e.O()}]);